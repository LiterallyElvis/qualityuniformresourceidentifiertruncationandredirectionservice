<html>
  <head>
    <title>
      Quality Uniform Resource Identifier Truncation And Redirection Service
    </title>
    <link rel="stylesheet" href="https://cdn.rawgit.com/twbs/bootstrap/v4-dev/dist/css/bootstrap.css" crossorigin="anonymous">
  </head>
  <body>
    <h3 id="pageTitle">Quality Uniform Resource Identifier Truncation And Redirection Service</h3>

    <div class="form-group has-danger" id="inputContainer">
      <label class="form-control-label" for="inputDanger">Enter a valid URL:</label>
      <input type="text" id="urlInput" class="inputs form-control">
      <button class="btn btn-default hidden" id="getUrlButton">Get URL!</button>
    </div>

    <input type="text" id="urlOutput" class="inputs form-control hidden">

    <style>
      body {
        text-align: center;
      }

      .hidden{
        display: none;
      }

      .inputs {
        margin: 0 auto;
        width: 30%;
      }

      #pageTitle{
        margin: 2.5rem;
      }

      #getUrlButton{
        margin: 1.5rem;
      }
    </style>
    <script>
      // thanks https://gist.github.com/dperini/729294
      var urlValidation = new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$", "i");

      var inputContainer = document.getElementById("inputContainer");
      var inputField = document.getElementById("urlInput");
      var outputField = document.getElementById("urlOutput");
      var getUrlButton = document.getElementById("getUrlButton");

      inputField.addEventListener("keyup", function(e){
        var urlIsValid = urlValidation.test(inputField.value.trim())
        if( urlIsValid ){
          inputContainer.classList.add("has-success");
          inputContainer.classList.remove("has-danger");
          outputField.classList.remove("hidden");
          getUrlButton.classList.remove("hidden");
        } else {
          inputContainer.classList.remove("has-success");
          inputContainer.classList.add("has-danger");
          outputField.classList.add("hidden");
          getUrlButton.classList.add("hidden");
        }
      });

      getUrlButton.addEventListener('click', function(e){
        var urlIsValid = urlValidation.test(inputField.value.trim())

        if( urlIsValid ){
          var request = new XMLHttpRequest();
          request.open('GET', '//localhost:8080/api/add?url=' + encodeURIComponent(inputField.value.trim()), true);

          request.onload = function() {
            if (request.status >= 200 && request.status < 400) {
              // Success!
              // var data = JSON.parse(request.responseText);
              console.log('data returned: \n\t', request.responseText)
              outputField.value = request.responseText;
            } else {
              // We reached our target server, but it returned an error
              console.log('error encountered! \n\t' + request.responseText);
              outputField.value = request.responseText;
            }
          };

          request.onerror = function() {
            // There was a connection error of some sort
            console.log('Oh no! \n\t' + request.responseText);
              outputField.value = request.responseText;
          };

          request.send();
        }
      });
    </script>
  </body>
</html>